import os
import sys
import subprocess

# Check the current Roundcube version
def get_roundcube_version():
    try:
        result = subprocess.check_output(["roundcube", "--version"])
        version = result.decode("utf-8").strip()
        return version
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)

# Check if the Roundcube version is vulnerable
def is_vulnerable_version(version):
    vulnerable_versions = ["1.1.0", "1.1.9", "1.2.0", "1.2.6", "1.3.0", "1.3.2"]
    for v in vulnerable_versions:
        if version.startswith(v):
            return True
    return False

# Update Roundcube to the latest version
def update_roundcube():
    try:
        subprocess.check_output(["sudo", "apt-get", "update"])
        subprocess.check_output(["sudo", "apt-get", "upgrade", "roundcube"])
        print("Roundcube has been updated to the latest version.")
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)

def main():
    version = get_roundcube_version()
    print(f"Current Roundcube version: {version}")

    if is_vulnerable_version(version):
        print("Vulnerable Roundcube version detected. Updating...")
        update_roundcube()
    else:
        print("Roundcube version is not vulnerable. No action needed.")

if __name__ == "__main__":
    main()
